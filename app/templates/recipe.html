{% extends 'base.html' %}

{% block title %}{{ recipe.title }}{% endblock %}

{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/recipe.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">
  <!-- Recipe Content -->
  <div class="recipe-content">
    <div class="recipe-top-own">
      <h1 class="recipe-title">{{ recipe.title }}</h1>
      {% if recipe.is_head %}
      <div class="top-btns">
        <script>
          function redirectToVersions() {
            window.location.href = '/u/{{ current_user.username }}/{{ recipe.id }}/versions';
          }
        </script>
        {% if recipe.version != 1%}
        <button class="prev-version-button" onclick="redirectToVersions()">Previous Versions</button>
        {% endif %}
        <button class="edit-btn"
          onclick="location.href ='/u/{{ current_user.username }}/{{ recipe.id }}/edit';">Edit</button>
      </div>
      {% endif %}
    </div>
    <h2 class="section-label">Description</h2>
    <p class="recipe-description">{{ recipe.description }}</p>
    <div class="recipe-details">
      {% if recipe.gf %}
      <span class="recipe-badge">Gluten Free</span>
      {% endif %}
      {% if recipe.vegan %}
      <span class="recipe-badge">Vegan</span>
      {% endif %}
    </div>
    <h2 class="section-label">Ingredients</h2>
    <ul class="ingredients-list" id="ingredients-list">
      {% for ingredient in recipe.ingredients %}
      <li>{{ ingredient.name }}, {{ ingredient.quantity }} {{ ingredient.unit }}</li>
      {% endfor %}
    </ul>
    <h2 class="section-label">Instructions</h2>
    <p>{{ recipe.instructions }}</p>
    <div class="recipe-update-info">
      <span>Created on: {{ recipe.created_at.strftime('%Y-%m-%d') }}</span>
      <div class="version-lable">
        <span>Version: {{ recipe.version }}</span>
      </div>
    </div>
    <div class="bottom-btns">
        <button class="back-to-profile-btn" onclick="location.href ='/u/{{ current_user.username }}';">Back to
        Profile</button>
        {% if recipe.is_head %}
        <button type="button" id="add-collaborator-button" class="add-collaborator-button">Add Collaborator</button>
        {% endif %}
    </div>
  </div>


  <div id="collaboratorModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Invite Collaborator</h2>
      <div class="modal-search-container">
        <input type="text" id="collaboratorUsername" placeholder="Enter username (next to logout)" />
        <button type="button" id="searchCollaborator">Search</button>
      </div>
      <p class="disclaimer">Note: Max 1 collaborator</p>
    </div>
  </div>

  <script src="{{ url_for('static', filename='script/modal.js') }}"></script>
  {% endblock %}